
<script src="{{ site.baseurl }}/js/search-index.js"></script>
<script id="result-template" type="x-tmpl-mustache">
{% raw %}
  <magic-item>
    <item-name>{{title}}</item-name>
    <item-tags>
      <item-rarity>{{rarity}}</item-rarity>
      <item-attunement>{{#attunement}} requires attunement {{requirement}}{{/attunement}}</item-attunement>
    </item-tags>
    <item-description>
      {{{content}}}
    </item-description>
  </magic-item>
  {% endraw %}
</script>
<script>
  $(document).ready(function() {
    var searchbox = $('input#search');
    var searchResults = $('#searchResults');
    var template = $('#result-template').html();
    Mustache.parse(template);

    $("#search-btn").on("click", function(){
       search();
    });
    $("#search").on('keyup', function (e) {
        if (e.keyCode == 13) {
             search();
        }
    });

    function search(){
      var query = searchbox.val();
      var results = search_index.search(query);
      searchResults.empty();

      for (var item in results){
        var ref = results[item].ref;
        var result = item_cache[ref];
        loadResult(result);
      }

      $("<style id='search-style' type='text/css'> magic-item{display:none} #searchResults magic-item{display:block}</style>").appendTo("head")
    }

    function unsearch(){
      searchResults.empty();
      $("#search-style").remove();
    }

    function loadResult(result) {
      searchResults.append(Mustache.render(template, result));
    };
  });
</script>
