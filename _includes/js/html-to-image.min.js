"use strict";var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function u(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(r){return function(u){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,u])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFontEmbedCSS=exports.toBlob=exports.toJpeg=exports.toPng=exports.toPixelData=exports.toCanvas=exports.toSvg=void 0;var cloneNode_1=require("./cloneNode"),embedImages_1=require("./embedImages"),applyStyleWithOptions_1=require("./applyStyleWithOptions"),embedWebFonts_1=require("./embedWebFonts"),util_1=require("./util");function getImageSize(t,e){return void 0===e&&(e={}),{width:e.width||(0,util_1.getNodeWidth)(t),height:e.height||(0,util_1.getNodeHeight)(t)}}function toSvg(t,e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,(function(){var n,i,o;return __generator(this,(function(r){return n=getImageSize(t,e),i=n.width,o=n.height,[2,Promise.resolve(t).then((function(t){return(0,cloneNode_1.cloneNode)(t,e,!0)})).then((function(t){return(0,embedWebFonts_1.embedWebFonts)(t,e)})).then((function(t){return(0,embedImages_1.embedImages)(t,e)})).then((function(t){return(0,applyStyleWithOptions_1.applyStyleWithOptions)(t,e)})).then((function(t){return(0,util_1.nodeToDataURL)(t,i,o)}))]}))}))}exports.toSvg=toSvg;var dimensionCanvasLimit=16384;function checkCanvasDimensions(t){(t.width>dimensionCanvasLimit||t.height>dimensionCanvasLimit)&&(t.width>dimensionCanvasLimit&&t.height>dimensionCanvasLimit?t.width>t.height?(t.height*=dimensionCanvasLimit/t.width,t.width=dimensionCanvasLimit):(t.width*=dimensionCanvasLimit/t.height,t.height=dimensionCanvasLimit):t.width>dimensionCanvasLimit?(t.height*=dimensionCanvasLimit/t.width,t.width=dimensionCanvasLimit):(t.width*=dimensionCanvasLimit/t.height,t.height=dimensionCanvasLimit))}function toCanvas(t,e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,toSvg(t,e).then(util_1.createImage).then((function(n){var i=document.createElement("canvas"),o=i.getContext("2d"),r=e.pixelRatio||(0,util_1.getPixelRatio)(),a=getImageSize(t,e),u=a.width,s=a.height,h=e.canvasWidth||u,d=e.canvasHeight||s;return i.width=h*r,i.height=d*r,e.skipAutoScale||checkCanvasDimensions(i),i.style.width=""+h,i.style.height=""+d,e.backgroundColor&&(o.fillStyle=e.backgroundColor,o.fillRect(0,0,i.width,i.height)),o.drawImage(n,0,0,i.width,i.height),i}))]}))}))}function toPixelData(t,e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,(function(){var n,i,o;return __generator(this,(function(r){return n=getImageSize(t,e),i=n.width,o=n.height,[2,toCanvas(t,e).then((function(t){return t.getContext("2d").getImageData(0,0,i,o).data}))]}))}))}function toPng(t,e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,toCanvas(t,e).then((function(t){return t.toDataURL()}))]}))}))}function toJpeg(t,e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,toCanvas(t,e).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))]}))}))}function toBlob(t,e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,toCanvas(t,e).then(util_1.canvasToBlob)]}))}))}function getFontEmbedCSS(t,e){return void 0===e&&(e={}),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return[2,(0,embedWebFonts_1.getWebFontCSS)(t,e)]}))}))}exports.toCanvas=toCanvas,exports.toPixelData=toPixelData,exports.toPng=toPng,exports.toJpeg=toJpeg,exports.toBlob=toBlob,exports.getFontEmbedCSS=getFontEmbedCSS;
//# sourceMappingURL=/sm/3b388c66a2fddb5350f34b6b7d2b6c09309b701896470f9e06ff20d1ccf2fce5.map
